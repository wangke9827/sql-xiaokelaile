# README

计算出平台最高峰同时在线的主播人数。

## 建表语句

```sql
create table login_log(id int,stt string,edt string) row format delimited fields terminated by '\t';

insert into table login_log values    
    (1001, '2021-06-14 12:12:12', '2021-06-14 18:12:12'),
    (1003, '2021-06-14 13:12:12', '2021-06-14 16:12:12'),
    (1004, '2021-06-14 13:15:12', '2021-06-14 20:12:12'),
    (1002, '2021-06-14 15:12:12', '2021-06-14 16:12:12'),
    (1005, '2021-06-14 15:18:12', '2021-06-14 20:12:12'),
    (1001, '2021-06-14 20:12:12', '2021-06-14 23:12:12'),
    (1006, '2021-06-14 21:12:12', '2021-06-14 23:15:12'),
    (1007, '2021-06-14 22:12:12', '2021-06-14 23:10:12');
```

## 思路分析

设 online_state 标识主播在线状态，1 表示在线人数加一，-1 表示在线人数减一，那么 sum(online_state) 即可表示当前在线主播数（初始在线人数为 0）。

因为只有在主播上下线发生时，当前在线人数才会发生变化，所以统计当前在线人数可以看作统计**当前时间之前有主播上下线时的在线人数**，转换为 SQL 逻辑则是：`sum() over(order by op_tim)`，Hive 中如如果指定了 order by 子句但是没有 window 子句，则默认从开始行到当前行，利用这个特性可以实现计算从开始到当前时间的人数和。